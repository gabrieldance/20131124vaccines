<!DOCTYPE html>
<html>
<head>
	<title>vaccines efficacy</title>
</head>
<body>

<div id="chart_div">
	
</div>


<script type="text/javascript" src="js/d3.min.js"></script>

<style>
	.axis {
	  font: 10px sans-serif;
	}

	.axis path{
		fill:none;
		stroke:none;
	}

	.axis line {
	  fill: none;
	  stroke: none;
	  shape-rendering: crispEdges;
	}

	.axis text{
		font-family: 'Arial';
		font-weight: 100;
		fill:#717171;
	}

	.slope_line {
		opacity: .5;
		stroke: red;
		stroke-width:.5px;
	}

	.perc_line{
		opacity: .7;
		width: .5px;
		stroke: #f00;
		stroke-width:.5px;
	}


</style>


<script>
	"use strict"
	console.log("loaded",d3)

	var w=800,h=600;
	var margin={left:250,right:250,top:50,bottom:50};
	
	var svg=d3.select('#chart_div').append('svg')
		.attr("width",w)
		.attr("height",h)
		.attr("class",'chart')
	
	var morbidityScale=d3.scale.log()
		.range([h-margin.bottom,margin.top])

	var percScale=d3.scale.linear()
		.range([h-margin.bottom,margin.top])

	var morbidityAxis=d3.svg.axis()
		.scale(morbidityScale)
		.orient("left")
		.ticks(1,d3.format(",.0f"))

	var percAxis=d3.svg.axis()
		.scale(percScale)
		.orient('right');

	var vaccines;

	var line = d3.svg.line()
  		.y(function(d) { return morbidityScale(d); })
  		.x(function(d) { return xscale(d[0]); });

	d3.tsv("data/vaccines.tsv", type,function(error, data) {
		console.log(data)
		vaccines=data;

		morbidityScale.domain([.1,d3.max(data,function(d){ return d.MORBIDITY })])
		percScale.domain([d3.min(data,function(d){ return d.PERCENT_DEC }),d3.max(data,function(d){ return d.PERCENT_DEC })])
		console.log(morbidityScale.domain())
		console.log(percScale.domain())


		svg.append("g")
			.attr("class", "axis")
			.attr('transform','translate('+(margin.left-10)+',0)')
			.call(morbidityAxis);

		console.log(morbidityScale.ticks())
		// svg.append("g")
		// 	.attr("class", "axis")
		// 	.attr('transform','translate('+(w-margin.right+10)+',0)')
		// 	.call(percAxis);


		data.forEach(function(v,i){
			console.log(v,i)

			svg.append('svg:line')
				.datum(v)
				.attr('x1',margin.left)
				.attr('y1',function(d){ return morbidityScale(d.MORBIDITY) })
				.attr('x2',w-margin.right)
				.attr('y2',function(d){ return morbidityScale(d.CASES_2010+.1) })
				.attr('class','slope_line')

			// svg.append('svg:line')
			// 	.datum(v)
			// 	.attr('x1',margin.left)
			// 	.attr('y1',function(d){ return percScale(d.PERCENT_DEC) })
			// 	.attr('x2',w-margin.right)
			// 	.attr('y2',function(d){ return percScale(d.PERCENT_DEC) })
			// 	.attr('class','perc_line')


		})

	});

	function type(d) {
		d.MORBIDITY = +d.MORBIDITY;
		d.CASES_2010 = +d.CASES_2010;
		d.PERCENT_DEC= d.PERCENT_DEC;
		d.PERCENT_DEC=(1-d.CASES_2010/d.MORBIDITY)*100;
		return d;
	}

</script>


</body>
</html>