<!DOCTYPE html>
<html>
<head>
	<title>vaccines efficacy</title>
</head>
<body>

<div id="chart_div">
	
</div>


<script type="text/javascript" src="js/d3.min.js"></script>

<style>
	.axis {
	  font: 10px sans-serif;
	}

	.axis path{
		fill:none;
		stroke:none;
	}

	.axis line {
	  fill: none;
	  stroke: none;
	  shape-rendering: crispEdges;
	}

	.axis text{
		font-family: 'Arial';
		font-weight: 100;
		fill:#717171;
	}

	.slope_line {
		opacity: 1;
		stroke-width:.5px;
	}

	.perc_line{
		opacity: .7;
		width: .5px;
		stroke: #f00;
		stroke-width:.5px;
	}


</style>


<script>
	"use strict"
	console.log("loaded",d3)

	var w=800,h=600;
	var margin={left:100,right:50,top:50,bottom:50};
	
	var svg=d3.select('#chart_div').append('svg')
		.attr("width",w)
		.attr("height",h)
		.attr("class",'chart')
	
	var morbidityLogScale=d3.scale.log()
		.range([h-margin.bottom,margin.top])

	var morbidityLinearScale=d3.scale.linear()
		.range([h-margin.bottom,margin.top])

	var percScale=d3.scale.linear()
		.range([h-margin.bottom,margin.top])

	var morbidityLogAxis=d3.svg.axis()
		.scale(morbidityLogScale)
		.orient("left")
		.ticks(1,d3.format(",.0f"))

	var morbidityLinearAxis=d3.svg.axis()
		.scale(morbidityLinearScale)
		.orient("left")
		// .ticks(1,d3.format(",.0f"))



	var percAxis=d3.svg.axis()
		.scale(percScale)
		.orient('right');

	var vaccines;

	var slopeColors=["#F4B2E2","#F3FF47","#1A3C0E","#A0272C","#7EA078","#412B67","#F69431","#3B76E9","#C32998","#1F7877","#35A777","#5F4804","#E48F97","#1E2F48","#8B4308"]

	d3.tsv("data/vaccines.tsv", type,function(error, data) {
		console.log(data)
		vaccines=data;

		morbidityLogScale.domain([.1,d3.max(data,function(d){ return d.MORBIDITY })]).clamp(true)
		morbidityLinearScale.domain([0,d3.max(data,function(d){ return d.MORBIDITY })])
		percScale.domain([d3.min(data,function(d){ return d.PERCENT_DEC }),d3.max(data,function(d){ return d.PERCENT_DEC })])
		
		console.log(morbidityLinearScale.domain())
		console.log(percScale.domain())


		svg.append("g")
			.attr("class", "axis")
			.attr('transform','translate('+(margin.left)+',0)')
			.call(morbidityLogAxis);

		svg.append("g")
			.attr("class", "axis")
			.attr('transform','translate('+(w/2+margin.left)+',0)')
			.call(morbidityLinearAxis);

		console.log(morbidityLogScale.ticks())
		// svg.append("g")
		// 	.attr("class", "axis")
		// 	.attr('transform','translate('+(w-margin.right+10)+',0)')
		// 	.call(percAxis);


		data.forEach(function(v,i){
			console.log(v,i)

			svg.append('svg:line')
				.datum(v)
				.attr('x1',margin.left)
				.attr('y1',function(d){ return morbidityLogScale(d.MORBIDITY) })
				.attr('x2',w/2-margin.right)
				.attr('y2',function(d){ return morbidityLogScale(d.CASES_2010) })
				.attr('class','slope_line')
				.style('stroke',slopeColors[i])

			svg.append('svg:line')
				.datum(v)
				.attr('x1',w/2+margin.left)
				.attr('y1',function(d){ return morbidityLinearScale(d.MORBIDITY) })
				.attr('x2',w-margin.right)
				.attr('y2',function(d){ return morbidityLinearScale(d.CASES_2010) })
				.attr('class','slope_line')	
				.style('stroke',slopeColors[i])

			// svg.append('svg:line')
			// 	.datum(v)
			// 	.attr('x1',margin.left)
			// 	.attr('y1',function(d){ return percScale(d.PERCENT_DEC) })
			// 	.attr('x2',w-margin.right)
			// 	.attr('y2',function(d){ return percScale(d.PERCENT_DEC) })
			// 	.attr('class','perc_line')


		})

	});

	function type(d) {
		d.MORBIDITY = +d.MORBIDITY;
		d.CASES_2010 = +d.CASES_2010;
		d.PERCENT_DEC= d.PERCENT_DEC;
		d.PERCENT_DEC=(1-d.CASES_2010/d.MORBIDITY)*100;
		return d;
	}

</script>


</body>
</html>